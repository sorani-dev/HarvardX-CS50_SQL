<!DOCTYPE html><html lang="en-us"><head>

        <meta charset="utf-8">
        <meta name="viewport" content="initial-scale=1, width=device-width"><meta property="og:description" content="An introduction to databases using a language called SQL.">

        <meta property="og:image" content="https://prod-discovery.edx-cdn.org/media/course/image/3e45c431-10df-423e-9f03-fb98b713cd4a-5158ac9c653a.small.png"><meta property="og:title" content="Lecture 6 - CS50's Introduction to Databases with SQL">

        <link href="../../favicon.ico?1696908740" rel="icon">

        <!-- https://fonts.google.com/specimen/PT+Sans?query=PT+Sans&selection.family=PT+Sans:ital,wght@0,400;0,700;1,400;1,700 -->
        <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"></script>

        <!-- https://getbootstrap.com/docs/ -->
        <script src="../../assets/jquery/dist/jquery.min.js?1696908740"></script>
        <script src="../../assets/bootstrap/dist/js/bootstrap.bundle.min.js?1696908740"></script>

        <!-- https://bootstrap-table.com/docs/getting-started/introduction/ -->
        <link href="../../assets/bootstrap-table/dist/bootstrap-table.min.css?1696908740" rel="stylesheet">
        <script src="../../assets/bootstrap-table/dist/bootstrap-table.min.js?1696908740"></script>
        <script src="../../assets/bootstrap-table/dist/extensions/mobile/bootstrap-table-mobile.min.js?1696908740"></script>

        <!-- https://fontawesome.com/how-to-use/on-the-web/referencing-icons/basic-use -->
        
        <link crossorigin="anonymous" href="https://kit.fontawesome.com/a6e66aa089.css" rel="stylesheet">
        

        <!-- https://moment.github.io/luxon/ -->
        <script src="../../assets/luxon/build/global/luxon.min.js?1696908740"></script>

        <!-- http://docs.mathjax.org/ -->
        <!-- http://docs.mathjax.org/en/latest/options/output/chtml.html?highlight=displayAlign#the-configuration-block -->
        <script>
            MathJax = {
               chtml: {
                    displayAlign: "left"
                }
            };
        </script>
        <script src="../../assets/mathjax/es5/tex-chtml.js?1696908740"></script>

        <!-- https://github.com/verlok/vanilla-lazyload -->
        <script src="../../assets/intersection-observer/intersection-observer.js?1696908740"></script>
        <script src="../../assets/vanilla-lazyload/dist/lazyload.min.js?1696908740"></script>

        <!-- https://github.com/davidjbradshaw/iframe-resizer -->
        <script src="../../assets/iframe-resizer/js/iframeResizer.min.js?1696908740"></script>

        <!-- https://github.com/scratchblocks/scratchblocks/releases -->
        <script src="../../assets/scratchblocks.min.js?1696908740"></script>

        <!-- https://mermaid-js.github.io/ -->
        <script src="../../assets/mermaid.min.js?1696908740"></script>

        <!-- https://github.com/twitter/twemoji -->
        <script src="../../assets/twemoji/dist/twemoji.min.js?1696908740"></script>

        

        <link href="../../assets/page.css?1696908740" rel="stylesheet">
        <script src="../../assets/jekyll-theme-cs50.js?1696908740"></script>

        <script>
            window.CS50 = {
                local: {"day":"numeric","hour":"numeric","minute":"numeric","month":"long","timeZoneName":"short","weekday":"long","year":"numeric"},
                locale: "en",
                tz: "America/New_York"
            };
        </script>

        <title>Lecture 6 - CS50's Introduction to Databases with SQL</title>


    </head>

    <body class="invisible">

        <div class="alert fixed-top mb-0 rounded-0" data-alert="success dismissible" data-hash="0129a290f1b935ef2af9c47f24376fe8" id="alert" role="alert">
            <button aria-label="Close" class="btn-close d-none" data-bs-dismiss="alert" type="button"></button><p>Interested in <a href="../../#how-to-take-this-course">a verified certificate or transfer credit and accreditation</a>?</p></div>
        

        <div class="container-fluid">

            <div class="row">

                <aside class="col-lg">
 
                    <header><h1 data-id="cs50s-introduction-to-databases-with-sql"><a href="../..">CS50’s Introduction to Databases with SQL</a></h1>

<p>OpenCourseWare</p>

<p><a class="pr-1 small" href="https://cs50.harvard.edu/donate">Donate<i aria-hidden="true" class="fas fa-external-link-alt ps-2"></i></a></p>

<p class="small"><a href="https://carterzenke.me">Carter Zenke</a><br>
<a href="mailto:carter@cs50.harvard.edu">carter@cs50.harvard.edu</a>
<br>
<a class="mr-1" href="https://github.com/carterzenke"><i aria-hidden="true" class="fab fa-github" title="GitHub"></i><span class="sr-only">GitHub</span></a>
<a class="mr-1" href="https://www.linkedin.com/in/carterzenke/"><i aria-hidden="true" class="fab fa-linkedin" title="LinkedIn"></i><span class="sr-only">LinkedIn</span></a></p>

<p class="small"><a href="https://cs.harvard.edu/malan/">David J. Malan</a>
<br>
<a href="mailto:malan@harvard.edu">malan@harvard.edu</a>
<br>
<a class="mr-1" href="https://www.facebook.com/dmalan"><i aria-hidden="true" class="fa-brands fa-facebook-f" title="Facebook"></i><span class="sr-only">Facebook</span></a>
<a class="mr-1" href="https://github.com/dmalan"><i aria-hidden="true" class="fa-brands fa-github" title="GitHub"></i><span class="sr-only">GitHub</span></a>
<a class="mr-1" href="https://www.instagram.com/davidjmalan/"><i aria-hidden="true" class="fa-brands fa-instagram" title="Instagram"></i><span class="sr-only">Instagram</span></a>
<a class="mr-1" href="https://www.linkedin.com/in/malan/"><i aria-hidden="true" class="fa-brands fa-linkedin" title="LinkedIn"></i><span class="sr-only">LinkedIn</span></a>
<a class="mr-1" href="https://www.reddit.com/user/davidjmalan"><i aria-hidden="true" class="fa-brands fa-reddit-alien" title="Reddit"></i><span class="sr-only">Reddit</span></a>
<a class="mr-1" href="https://www.threads.net/@davidjmalan"><i aria-hidden="true" class="fa-brands fa-threads" title="Threads"></i><span class="sr-only">Threads</span></a>
<a class="mr-1" href="https://twitter.com/davidjmalan"><i aria-hidden="true" class="fa-brands fa-twitter" title="Twitter"></i><span class="sr-only">Twitter</span></a></p></header>

                    

                    <button aria-controls="nav" aria-expanded="false" class="btn btn-sm collapsed d-lg-none" data-bs-target="aside > nav" data-bs-toggle="collapse">
                        Menu
                    </button>

                    <nav class="collapse d-lg-block" id="nav"><hr>

<ul>
  <li data-marker="*"><a href="https://cs50.harvard.edu/x/2023/ready/"><i class="fa-solid fa-duck me-2"></i>Ready Player 50</a></li>
  <li data-marker="*"><a href="../../zoom/"><i class="fa-solid fa-video me-2"></i>Zoom Meetings<span class="badge ms-2 p-1 text-bg-warning">new</span></a></li>
</ul>

<hr>

<ul>
  <li data-marker="*"><a href="https://cs50.ai/"><i class="fa-solid fa-duck pe-2 text-decoration-none"></i>CS50.ai</a></li>
  <li data-marker="*"><a href="https://cs50.edx.org/ed"><i class="fa-solid fa-comment-question pe-2 text-decoration-none"></i>Ed Discussion</a> for Q&amp;A</li>
</ul>

<hr>

<ol start="0">
  <li><a href="../../weeks/0/">Querying</a></li>
  <li><a href="../../weeks/1/">Relating</a></li>
  <li><a href="../../weeks/2/">Designing</a></li>
  <li><a href="../../weeks/3/">Writing</a></li>
  <li><a href="../../weeks/4/">Viewing</a></li>
  <li><a href="../../weeks/5/">Optimizing</a></li>
  <li><a href="../../weeks/6/">Scaling</a></li>
</ol>

<ul>
  <li data-marker="*"><a href="../../project/">Final Project</a></li>
</ul>

<hr>

<ul>
  <li data-marker="*"><a href="../../honesty/">Academic Honesty</a></li>
  <li data-marker="*"><a href="../../certificate/">CS50 Certificate</a></li>
  <li data-marker="*"><a href="../../faqs/">FAQs</a></li>
  <li data-marker="*"><a href="https://cs50.me/cs50sql">Gradebook</a></li>
  <li data-marker="*"><a href="../../psets/">Problem Sets</a></li>
</ul>

<hr>

<ul class="small">
  <li data-marker="*"><a href="https://apps.apple.com/us/app/cs50/id1631064453">Apple TV</a></li>
  <li data-marker="*"><a href="https://cs50.edx.org/sql">edX</a></li>
  <li data-marker="*"><a href="https://play.google.com/store/apps/details?id=edu.harvard.cs50.googletv">Google TV</a></li>
  <li data-marker="*"><a href="https://web.dce.harvard.edu/extension/csci/e/151">Harvard Extension School</a></li>
  <li data-marker="*"><a href="https://web.dce.harvard.edu/summer/csci/s/151">Harvard Summer School</a></li>
  <li data-marker="*"><a href="https://www.youtube.com/playlist?list=PLhQjrBD2T382v1MBjNOhPu9SiJ1fsD4C0">YouTube</a></li>
</ul>

<hr>

<ul class="small">
  <li data-marker="*"><a href="https://cs50.statuspage.io/">Status Page</a></li>
</ul>

<hr>

<ul>
  <li data-marker="*"><a href="../../communities/"><strong>Communities</strong></a></li>
  <li data-marker="*" class="small"><a href="https://cs50.bsky.social">Bluesky</a></li>
  <li data-marker="*" class="small"><a href="https://www.clubhouse.com/club/cs50">Clubhouse</a></li>
  <li data-marker="*" class="small"><a href="https://discord.gg/cs50">Discord</a> <span class="badge bg-light ms-1 py-1 rounded-pill text-dark">Q&amp;A</span></li>
  <li data-marker="*" class="small"><a href="https://cs50.edx.org/ed">Ed</a> <span class="badge bg-light ms-1 py-1 rounded-pill text-dark">Q&amp;A</span></li>
  <li data-marker="*" class="small"><a href="https://www.facebook.com/groups/cs50/">Facebook Group</a> <span class="badge bg-light ms-1 py-1 rounded-pill text-dark">Q&amp;A</span></li>
  <li data-marker="*" class="small"><a href="https://www.facebook.com/cs50/">Facebook Page</a></li>
  <li data-marker="*" class="small"><a href="https://github.com/cs50">GitHub</a></li>
  <li data-marker="*" class="small"><a href="https://gitter.im/cs50/x">Gitter</a> <span class="badge bg-light ms-1 py-1 rounded-pill text-dark">Q&amp;A</span></li>
  <li data-marker="*" class="small"><a href="https://instagram.com/cs50">Instagram</a></li>
  <li data-marker="*" class="small"><a href="https://www.linkedin.com/groups/7437240/">LinkedIn Group</a></li>
  <li data-marker="*" class="small"><a href="https://www.linkedin.com/school/CS50/">LinkedIn Page</a></li>
  <li data-marker="*" class="small"><a href="https://cs50.medium.com/">Medium</a></li>
  <li data-marker="*" class="small"><a href="https://www.quora.com/topic/CS50">Quora</a></li>
  <li data-marker="*" class="small"><a href="https://www.reddit.com/r/cs50/">Reddit</a> <span class="badge bg-light ms-1 py-1 rounded-pill text-dark">Q&amp;A</span></li>
  <li data-marker="*" class="small"><a href="https://cs50.edx.org/slack">Slack</a> <span class="badge bg-light ms-1 py-1 rounded-pill text-dark">Q&amp;A</span></li>
  <li data-marker="*" class="small"><a href="https://www.snapchat.com/add/cs50">Snapchat</a></li>
  <li data-marker="*" class="small"><a href="https://soundcloud.com/cs50">SoundCloud</a></li>
  <li data-marker="*" class="small"><a href="https://cs50.stackexchange.com/">Stack Exchange</a> <span class="badge bg-light ms-1 py-1 rounded-pill text-dark">Q&amp;A</span></li>
  <li data-marker="*" class="small"><a href="https://www.tiktok.com/@cs50">TikTok</a></li>
  <li data-marker="*" class="small"><a href="https://twitter.com/cs50">Twitter</a></li>
  <li data-marker="*" class="small"><a href="http://www.youtube.com/subscription_center?add_user=cs50tv">YouTube</a></li>
</ul>

<hr>

<p><a href="https://cs50.harvardshop.com/"><img src="https://cs50.harvard.edu/x/2023/assets/shop.png" alt="Harvard Shop"></a></p>

<hr>

<p><a href="../../license/" class="small"><i class="fab fa-creative-commons me-1"></i>License</a></p></nav>

                    <footer></footer>

                </aside>

                <main class="col-lg">

                    <h1 class="no_toc" id="lecture-6">Lecture 6</h1>

<ul id="markdown-toc">
  <li><a href="#introduction" id="markdown-toc-introduction">Introduction</a></li>
  <li><a href="#mysql" id="markdown-toc-mysql">MySQL</a></li>
  <li><a href="#creating-the-cards-table" id="markdown-toc-creating-the-cards-table">Creating the <code class="language-plaintext highlighter-rouge">cards</code> Table</a>    <ul>
      <li><a href="#questions" id="markdown-toc-questions">Questions</a></li>
    </ul>
  </li>
  <li><a href="#creating-the-stations-table" id="markdown-toc-creating-the-stations-table">Creating the <code class="language-plaintext highlighter-rouge">stations</code> Table</a>    <ul>
      <li><a href="#questions-1" id="markdown-toc-questions-1">Questions</a></li>
    </ul>
  </li>
  <li><a href="#creating-the-swipes-table" id="markdown-toc-creating-the-swipes-table">Creating the <code class="language-plaintext highlighter-rouge">swipes</code> Table</a>    <ul>
      <li><a href="#questions-2" id="markdown-toc-questions-2">Questions</a></li>
    </ul>
  </li>
  <li><a href="#altering-tables" id="markdown-toc-altering-tables">Altering Tables</a></li>
  <li><a href="#stored-procedures" id="markdown-toc-stored-procedures">Stored Procedures</a>    <ul>
      <li><a href="#questions-3" id="markdown-toc-questions-3">Questions</a></li>
    </ul>
  </li>
  <li><a href="#stored-procedures-with-parameters" id="markdown-toc-stored-procedures-with-parameters">Stored Procedures with Parameters</a></li>
  <li><a href="#postgresql" id="markdown-toc-postgresql">PostgreSQL</a>    <ul>
      <li><a href="#questions-4" id="markdown-toc-questions-4">Questions</a></li>
    </ul>
  </li>
  <li><a href="#creating-postgresql-tables" id="markdown-toc-creating-postgresql-tables">Creating PostgreSQL Tables</a></li>
  <li><a href="#scaling-with-mysql" id="markdown-toc-scaling-with-mysql">Scaling with MySQL</a></li>
  <li><a href="#access-controls" id="markdown-toc-access-controls">Access Controls</a></li>
  <li><a href="#sql-injection-attacks" id="markdown-toc-sql-injection-attacks">SQL Injection Attacks</a></li>
  <li><a href="#questions-5" id="markdown-toc-questions-5">Questions</a></li>
  <li><a href="#fin" id="markdown-toc-fin">Fin</a></li>
</ul>

<h2 id="introduction">Introduction</h2>

<ul>
  <li data-marker="*">Thus far in this course, we have learned how to design and create our own databases, read and write data and most recently, how to optimize our queries. Now, we will understand how to do all these things but at a larger scale.</li>
  <li data-marker="*">Scalability is the ability to increase or decrease the capacity of an application or database to meet demand.</li>
  <li data-marker="*">Social media platforms and banking systems are examples of applications that might need to scale as they grow bigger and gain more users.</li>
  <li data-marker="*">In this lecture, we will use different database management systems like MySQL and PostgreSQL which can be used to scale databases.</li>
  <li data-marker="*">SQLite is an embedded database, but MySQL and PostgreSQL are database servers — they often run on their own dedicated hardware that we can connect to over the internet to run our SQL queries. This confers them the advantage of being able to store their data on RAM, resulting in faster queries.</li>
</ul>

<h2 id="mysql">MySQL</h2>

<ul>
  <li data-marker="*">
    <p>We will use the MBTA database that we have worked with in previous lectures. The following is the ER Diagram showing the entities Card, Swipe and Station and the relationship between these entities.</p>

    <p class="w-50"><img src="images/6.jpg" alt="&quot;ER Diagram for MBTA database with Card, Swipe and Station entities&quot;"></p>

    <ul>
      <li data-marker="*">As a reminder, riders who use the subway have a CharlieCard they swipe at stations to gain entry. Riders can recharge their cards and in some cases, they need to swipe their cards to leave a station as well. The MBTA does not store information about riders, but only keeps track of the cards.</li>
    </ul>
  </li>
  <li data-marker="*">
    <p>We want to create a database in MySQL with this schema! On the terminal, let’s connect to a MySQL server.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql -u root -h 127.0.0.1 -P 3306 -p
</code></pre></div>    </div>

    <ul>
      <li data-marker="*">In this terminal command, <code class="language-plaintext highlighter-rouge">-u</code> indicates the user. We provide the user we want to connect to the database as — <code class="language-plaintext highlighter-rouge">root</code> (synonymous with database admin, in this case).</li>
      <li data-marker="*"><code class="language-plaintext highlighter-rouge">127.0.0.1</code> is the address of local host on the internet (our own computer).</li>
      <li data-marker="*"><code class="language-plaintext highlighter-rouge">3306</code> is the port we want to connect to, and this is the default port where MySQL is hosted. Think of the combination of host and port as the address of the database we are trying to connect to!</li>
      <li data-marker="*"><code class="language-plaintext highlighter-rouge">-p</code> at the end of the command indicates that we want to be prompted for a password when connecting.</li>
    </ul>
  </li>
  <li data-marker="*">Since this a full database server with potentially many databases inside it. To show all the existing ones, we use the following MySQL command.
    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SHOW</span> <span class="n">DATABASES</span><span class="p">;</span>
</code></pre></div>    </div>
    <p>This returns some default databases already in the server.</p>
  </li>
  <li data-marker="*">We will perform some operations to set up the MBTA database. We have seen how to do these in SQLite already, so let’s focus on the syntax differences for MySQL!
    <ul>
      <li data-marker="*">
        <p>Creating a new database:</p>

        <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="nv">`mbta`</span><span class="p">;</span>
</code></pre></div>        </div>

        <p>Instead of quotation marks, we use backticks to identify the table name and other variables in our SQL statements.</p>
      </li>
      <li data-marker="*">
        <p>To change the current database to <code class="language-plaintext highlighter-rouge">mbta</code>:</p>

        <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">USE</span> <span class="nv">`mbta`</span><span class="p">;</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<h2 id="creating-the-cards-table">Creating the <code class="language-plaintext highlighter-rouge">cards</code> Table</h2>

<ul>
  <li data-marker="*">
    <p>MySQL has more granularity with types than SQLite. For example, an integer could be <code class="language-plaintext highlighter-rouge">TINYINT</code>, <code class="language-plaintext highlighter-rouge">SMALLINT</code>, <code class="language-plaintext highlighter-rouge">MEDIUMINT</code>, <code class="language-plaintext highlighter-rouge">INT</code> or <code class="language-plaintext highlighter-rouge">BIGINT</code> based on the size of the number we want to store. The following table shows us the size and range of numbers we can store in each of the integer types.</p>

    <p class="w-50"><img src="images/12.jpg" alt="&quot;Table of integer types in MySQL&quot;"></p>

    <p>These ranges assume that we want to use a signed integer. If we use unsigned integers, the maximum value we could store with each integer type would double.</p>
  </li>
  <li data-marker="*">
    <p>Let us now create the table <code class="language-plaintext highlighter-rouge">cards</code> using an <code class="language-plaintext highlighter-rouge">INT</code> data type for the ID column. Since an <code class="language-plaintext highlighter-rouge">INT</code> can store a number up to 4 billion, it should be big enough for our use case!</p>

    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`cards`</span> <span class="p">(</span>
    <span class="nv">`id`</span> <span class="nb">INT</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="nv">`id`</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>    </div>

    <p>Note that we use the keyword <code class="language-plaintext highlighter-rouge">AUTO_INCREMENT</code> with the ID so that MySQL automatically inserts the next number as the ID for a new row.</p>
  </li>
</ul>

<h3 id="questions">Questions</h3>

<blockquote>
  <p>Should the ID column not be an unsigned integer? How can we denote that?</p>
</blockquote>

<ul>
  <li data-marker="*">Yes, we could explicitly make the ID an unsigned integer by adding the keyword <code class="language-plaintext highlighter-rouge">UNSIGNED</code> while creating the integer.</li>
</ul>

<h2 id="creating-the-stations-table">Creating the <code class="language-plaintext highlighter-rouge">stations</code> Table</h2>

<ul>
  <li data-marker="*">
    <p>After creating the table, we can see a list of the existing tables by running:</p>

    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SHOW</span> <span class="n">TABLES</span><span class="p">;</span>
</code></pre></div>    </div>
  </li>
  <li data-marker="*">
    <p>For further details about a table, we can use the <code class="language-plaintext highlighter-rouge">DESCRIBE</code> command.</p>

    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">DESCRIBE</span> <span class="nv">`cards`</span><span class="p">;</span>
</code></pre></div>    </div>
  </li>
  <li data-marker="*">To handle text, MySQL provides many types. Two commonly used ones are <code class="language-plaintext highlighter-rouge">CHAR</code> — a fixed width string, and <code class="language-plaintext highlighter-rouge">VARCHAR</code> — a string of variable length. MySQL also has a type <code class="language-plaintext highlighter-rouge">TEXT</code> but unlike in SQLite, this type is used for longer chunks of text like paragraphs, pages of books etc. Based on the length of the text, it could be one of: <code class="language-plaintext highlighter-rouge">TINYTEXT</code>, <code class="language-plaintext highlighter-rouge">TEXT</code>, <code class="language-plaintext highlighter-rouge">MEDIUMTEXT</code> and <code class="language-plaintext highlighter-rouge">LONGTEXT</code>. Additionally, we have the <code class="language-plaintext highlighter-rouge">BLOB</code> type to store binary strings.</li>
  <li data-marker="*">MySQL also provides two other text types: <code class="language-plaintext highlighter-rouge">ENUM</code> and <code class="language-plaintext highlighter-rouge">SET</code>. Enum restricts a column to a single predefined option from a list of options we provide. For example, shirt sizes could be enumerated to M, L, XL and so on. A set allows for multiple options to be stored in a single cell, useful for scenarios like movie genres.</li>
  <li data-marker="*">Now, let us create the <code class="language-plaintext highlighter-rouge">stations</code> table in MySQL.
    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`stations`</span> <span class="p">(</span>
    <span class="nv">`id`</span> <span class="nb">INT</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
    <span class="nv">`name`</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">UNIQUE</span><span class="p">,</span>
    <span class="nv">`line`</span> <span class="nb">ENUM</span><span class="p">(</span><span class="s1">'blue'</span><span class="p">,</span> <span class="s1">'green'</span><span class="p">,</span> <span class="s1">'orange'</span><span class="p">,</span> <span class="s1">'red'</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="nv">`id`</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>    </div>
    <ul>
      <li data-marker="*">We choose a <code class="language-plaintext highlighter-rouge">VARCHAR</code> for the station name because names might be an unknown length. The line that a station is on, however, is one of the existing subway lines in Boston. Since we know the values this could take, we can use an <code class="language-plaintext highlighter-rouge">ENUM</code> type.</li>
      <li data-marker="*">We also use column constraints <code class="language-plaintext highlighter-rouge">UNIQUE</code> and <code class="language-plaintext highlighter-rouge">NOT NULL</code> in the same way as we did with SQLite.</li>
    </ul>
  </li>
  <li data-marker="*">On running the command to describe this table, we see a similar output that lists out each of the columns in the table. Under the <code class="language-plaintext highlighter-rouge">Key</code> field, the primary key is recognized by <code class="language-plaintext highlighter-rouge">PRI</code> and any column with unique values is recognized by <code class="language-plaintext highlighter-rouge">UNI</code>. The <code class="language-plaintext highlighter-rouge">NULL</code> field tells us which columns allow <code class="language-plaintext highlighter-rouge">NULL</code> values, which none of the columns do for the <code class="language-plaintext highlighter-rouge">stations</code> table.</li>
</ul>

<h3 id="questions-1">Questions</h3>

<blockquote>
  <p>Can we use a table as the input to <code class="language-plaintext highlighter-rouge">ENUM</code>?</p>
</blockquote>

<ul>
  <li data-marker="*">This might be possible using a nested <code class="language-plaintext highlighter-rouge">SELECT</code> statement but this might not be a good idea if the values within the table change over time. It may be best to explicitly state values as the options for <code class="language-plaintext highlighter-rouge">ENUM</code>.</li>
</ul>

<blockquote>
  <p>If we do not know how long a piece of text will be and use something like <code class="language-plaintext highlighter-rouge">VARCHAR(300)</code> to represent it, is that okay?</p>
</blockquote>

<ul>
  <li data-marker="*">While this is okay, there is a trade-off here. We will lose 300 bytes of memory for every row of data inserted, which might not be worth it if we end up storing only very small strings. It might be better to start off with a smaller length and then alter the table to increase length if needed.</li>
</ul>

<h2 id="creating-the-swipes-table">Creating the <code class="language-plaintext highlighter-rouge">swipes</code> Table</h2>

<ul>
  <li data-marker="*">MySQL provides us with some options for storing dates and times, while in SQLite they had to be stored using the numeric type.</li>
  <li data-marker="*">We could use <code class="language-plaintext highlighter-rouge">DATE</code>, <code class="language-plaintext highlighter-rouge">YEAR</code>, <code class="language-plaintext highlighter-rouge">TIME</code>, <code class="language-plaintext highlighter-rouge">DATETIME</code> and <code class="language-plaintext highlighter-rouge">TIMESTAMP</code> (for more precise times) to store our date and time values. The last three allow an optional parameter to specify the precision with which we want to store the time.</li>
  <li data-marker="*">
    <p>In SQLite, we had a <code class="language-plaintext highlighter-rouge">REAL</code> data type. Here, our options are <code class="language-plaintext highlighter-rouge">FLOAT</code> and <code class="language-plaintext highlighter-rouge">DOUBLE PRECISION</code> as shown in the table below.</p>

    <p class="w-50"><img src="images/36.jpg" alt="&quot;Real Data types in MySQL&quot;"></p>

    <ul>
      <li data-marker="*">The amount of precision needs to be specified with the number of bytes, because of floating point imprecision. This means that with a limited amount of memory, floating point numbers can be represented only up to a certain precision. The more the bytes, the more the precision with which the number is represented.</li>
    </ul>
  </li>
  <li data-marker="*">There is also a way in MySQL to use a decimal (fixed precision) type. With this, we would specify the number of digits in the number to be represented, and the number of digits after the decimal point.</li>
  <li data-marker="*">
    <p>Let us now create the <code class="language-plaintext highlighter-rouge">swipes</code> table.</p>

    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`swipes`</span> <span class="p">(</span>
    <span class="nv">`id`</span> <span class="nb">INT</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
    <span class="nv">`card_id`</span> <span class="nb">INT</span><span class="p">,</span>
    <span class="nv">`station_id`</span> <span class="nb">INT</span><span class="p">,</span>
    <span class="nv">`type`</span> <span class="nb">ENUM</span><span class="p">(</span><span class="s1">'enter'</span><span class="p">,</span> <span class="s1">'exit'</span><span class="p">,</span> <span class="s1">'deposit'</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="nv">`datetime`</span> <span class="nb">DATETIME</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>
    <span class="nv">`amount`</span> <span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">CHECK</span><span class="p">(</span><span class="nv">`amount`</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">),</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="nv">`id`</span><span class="p">),</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span><span class="p">(</span><span class="nv">`station_id`</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="nv">`stations`</span><span class="p">(</span><span class="nv">`id`</span><span class="p">),</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span><span class="p">(</span><span class="nv">`card_id`</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="nv">`cards`</span><span class="p">(</span><span class="nv">`id`</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>    </div>
    <ul>
      <li data-marker="*">Notice the use of <code class="language-plaintext highlighter-rouge">DEFAULT CURRENT_TIMESTAMP</code> to indicate that the timestamp should be auto-filled to store the current time if no value is provided.</li>
      <li data-marker="*">The precision we choose for the swipe amount is 2. This is to ensure that cents get added or subtracted without any rounding.</li>
      <li data-marker="*">The column constraints from when we created the table in SQLite remain, including the check to make sure the swipe amount is not negative.</li>
    </ul>
  </li>
  <li data-marker="*">If we describe this table after creating it, we will see familiar output. The <code class="language-plaintext highlighter-rouge">Key</code> field has a new value, <code class="language-plaintext highlighter-rouge">MUL</code> (multiple) for the foreign key columns, indicating that they could have repeating values since they are foreign keys.</li>
</ul>

<h3 id="questions-2">Questions</h3>

<blockquote>
  <p>When we add constraints to a column, is there a precedence with which they take effect?</p>
</blockquote>

<ul>
  <li data-marker="*">No, the constraints work together in a combined manner. MySQL allows us to add constraints in any order while creating the table.</li>
</ul>

<blockquote>
  <p>Does MySQL have type affinities?</p>
</blockquote>

<ul>
  <li data-marker="*">Not exactly. MySQL does have data types, like <code class="language-plaintext highlighter-rouge">INT</code> and <code class="language-plaintext highlighter-rouge">VARCHAR</code> but unlike SQLite, it will not allow us to enter data of a different type and try to convert it.</li>
</ul>

<h2 id="altering-tables">Altering Tables</h2>

<ul>
  <li data-marker="*">MySQL allows us to alter tables more fundamentally than SQLite did.</li>
  <li data-marker="*">
    <p>If we wanted to add a silver line to the possible lines a station could be on, we can do the following.</p>

    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="nv">`stations`</span> 
<span class="k">MODIFY</span> <span class="nv">`line`</span> <span class="nb">ENUM</span><span class="p">(</span><span class="s1">'blue'</span><span class="p">,</span> <span class="s1">'green'</span><span class="p">,</span> <span class="s1">'orange'</span><span class="p">,</span> <span class="s1">'red'</span><span class="p">,</span> <span class="s1">'silver'</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">;</span>
</code></pre></div>    </div>
    <ul>
      <li data-marker="*">This allows us to modify the <code class="language-plaintext highlighter-rouge">line</code> column and change its type, such that the <code class="language-plaintext highlighter-rouge">ENUM</code> now includes silver as an option.</li>
      <li data-marker="*">Note also that we use the keyword <code class="language-plaintext highlighter-rouge">MODIFY</code> in addition to the <code class="language-plaintext highlighter-rouge">ALTER TABLE</code> construct we are familiar with from SQLite.</li>
    </ul>
  </li>
</ul>

<h2 id="stored-procedures">Stored Procedures</h2>
<ul>
  <li data-marker="*">Stored procedures are a way to automate SQL statements and run them repeatedly.</li>
  <li data-marker="*">To demonstrate stored procedures, we will again use a database from previous lectures — the Boston MFA database.</li>
  <li data-marker="*">Recall that we used views in SQLite to implement a soft-delete feature for <code class="language-plaintext highlighter-rouge">collections</code> in the MFA database. A view <code class="language-plaintext highlighter-rouge">current_collections</code> displayed all the collections not marked as deleted. We will now use a stored procedure in MySQL to do something similar.</li>
  <li data-marker="*">
    <p>Let’s navigate to the MFA database already created on our MySQL server.</p>

    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">USE</span> <span class="nv">`mfa`</span><span class="p">;</span>
</code></pre></div>    </div>
  </li>
  <li data-marker="*">
    <p>On describing the <code class="language-plaintext highlighter-rouge">collections</code> table, we see that the <code class="language-plaintext highlighter-rouge">deleted</code> column is not present and needs to be added to the table.</p>

    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="nv">`collections`</span> 
<span class="k">ADD</span> <span class="k">COLUMN</span> <span class="nv">`deleted`</span> <span class="nb">TINYINT</span> <span class="k">DEFAULT</span> <span class="mi">0</span><span class="p">;</span>
</code></pre></div>    </div>

    <p>Given that the <code class="language-plaintext highlighter-rouge">deleted</code> column only has values of 0 or 1, it is safe to use a <code class="language-plaintext highlighter-rouge">TINYINT</code>. We also assign the default as 0 because we want to keep all the collections already in the table.</p>
  </li>
  <li data-marker="*">
    <p>Before we create a stored procedure, we need to change the delimited from <code class="language-plaintext highlighter-rouge">;</code> to something else. Unlike SQLite, where we could type in multiple statements between a <code class="language-plaintext highlighter-rouge">BEGIN</code> and <code class="language-plaintext highlighter-rouge">END</code> (which we need for a stored procedure here) and end them with a <code class="language-plaintext highlighter-rouge">;</code>, MySQL prematurely ends the statement when it encounters a <code class="language-plaintext highlighter-rouge">;</code>.</p>

    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">delimiter</span> <span class="o">//</span>
</code></pre></div>    </div>
  </li>
  <li data-marker="*">
    <p>Now, we write the stored procedure.</p>

    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">PROCEDURE</span> <span class="nv">`current_collection`</span><span class="p">()</span>
<span class="k">BEGIN</span>
    <span class="k">SELECT</span> <span class="nv">`title`</span><span class="p">,</span> <span class="nv">`accession_number`</span><span class="p">,</span> <span class="nv">`acquired`</span> 
    <span class="k">FROM</span> <span class="nv">`collections`</span> 
    <span class="k">WHERE</span> <span class="nv">`deleted`</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">END</span><span class="o">//</span>
</code></pre></div>    </div>

    <p>Notice how we use empty parantheses next to the name of the procedure, perhaps reminiscent of functions in other programming languages. Similar to functions, we can also call stored procedures to run them.</p>
  </li>
  <li data-marker="*">
    <p>After creating this, we must reset the delimited to <code class="language-plaintext highlighter-rouge">;</code>.</p>

    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">delimiter</span> <span class="p">;</span>
</code></pre></div>    </div>
  </li>
  <li data-marker="*">
    <p>Let us try calling this procedure to see the current collections. At this point, the query should output all the rows in the <code class="language-plaintext highlighter-rouge">collections</code> table because we haven’t soft-deleted anything yet.</p>

    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CALL</span> <span class="n">current_collection</span><span class="p">();</span>
</code></pre></div>    </div>
  </li>
  <li data-marker="*">
    <p>If we soft-delete “Farmers working at dawn” and call the procedure again, we will find that the deleted row is not included in the output.</p>

    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">UPDATE</span> <span class="nv">`collections`</span> 
<span class="k">SET</span> <span class="nv">`deleted`</span> <span class="o">=</span> <span class="mi">1</span> 
<span class="k">WHERE</span> <span class="nv">`title`</span> <span class="o">=</span> <span class="s1">'Farmers working at dawn'</span><span class="p">;</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="questions-3">Questions</h3>

<blockquote>
  <p>Can we add parameters to stored procedures, ie, call them with some input?</p>
</blockquote>

<ul>
  <li data-marker="*">Yes, we can and we will see an example shortly!</li>
</ul>

<blockquote>
  <p>Can we call one procedure from another, like with functions?</p>
</blockquote>

<ul>
  <li data-marker="*">Yes. You could put most any SQL statement you write in a procedure as well.</li>
</ul>

<blockquote>
  <p>Can you leave any notes or comments in tables in MySQL?</p>
</blockquote>

<ul>
  <li data-marker="*">That definitely might be a useful feature! You could leave comments in a <code class="language-plaintext highlighter-rouge">schema.sql</code> file describing the intent behind different parts of the schema, but there may be ways to add comments in SQL tables as well.</li>
</ul>

<h2 id="stored-procedures-with-parameters">Stored Procedures with Parameters</h2>

<ul>
  <li data-marker="*">
    <p>When we previously worked with the MFA database, we had a table called <code class="language-plaintext highlighter-rouge">transactions</code> to log artwork being bought or sold, which we can create here as well.</p>

    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`transactions`</span> <span class="p">(</span>
    <span class="nv">`id`</span> <span class="nb">INT</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
    <span class="nv">`title`</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="nv">`action`</span> <span class="nb">ENUM</span><span class="p">(</span><span class="s1">'bought'</span><span class="p">,</span> <span class="s1">'sold'</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="nv">`id`</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>    </div>
  </li>
  <li data-marker="*">
    <p>Now, if a piece of artwork is deleted from <code class="language-plaintext highlighter-rouge">collections</code> because it is being sold, we would also like to update this in the <code class="language-plaintext highlighter-rouge">transactions</code> table. Usually, this would be two different queries but with a stored procedure, we can give this sequence one name.</p>

    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">delimiter</span> <span class="o">//</span>
<span class="k">CREATE</span> <span class="k">PROCEDURE</span> <span class="nv">`sell`</span><span class="p">(</span><span class="k">IN</span> <span class="nv">`sold_id`</span> <span class="nb">INT</span><span class="p">)</span>
<span class="k">BEGIN</span>
    <span class="k">UPDATE</span> <span class="nv">`collections`</span> <span class="k">SET</span> <span class="nv">`deleted`</span> <span class="o">=</span> <span class="mi">1</span> 
    <span class="k">WHERE</span> <span class="nv">`id`</span> <span class="o">=</span> <span class="nv">`sold_id`</span><span class="p">;</span>
    <span class="k">INSERT</span> <span class="k">INTO</span> <span class="nv">`transactions`</span> <span class="p">(</span><span class="nv">`title`</span><span class="p">,</span> <span class="nv">`action`</span><span class="p">)</span>
    <span class="k">VALUES</span> <span class="p">((</span><span class="k">SELECT</span> <span class="nv">`title`</span> <span class="k">FROM</span> <span class="nv">`collections`</span> <span class="k">WHERE</span> <span class="nv">`id`</span> <span class="o">=</span> <span class="nv">`sold_id`</span><span class="p">),</span> <span class="s1">'sold'</span><span class="p">);</span>
<span class="k">END</span><span class="o">//</span>
<span class="k">delimiter</span> <span class="p">;</span>
</code></pre></div>    </div>

    <p>The choice of the parameter for this procedure is the ID of the painting or artwork because it is a unique identifier.</p>
  </li>
  <li data-marker="*">
    <p>We can now call the procedure to sell a particular item. Suppose we want to sell “Imaginative landscape”.</p>

    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CALL</span> <span class="nv">`sell`</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
</code></pre></div>    </div>

    <p>We can display data from the <code class="language-plaintext highlighter-rouge">collections</code> and <code class="language-plaintext highlighter-rouge">transactions</code> tables to verify that the changes were made.</p>
  </li>
  <li data-marker="*">
    <p>What happens if I call <code class="language-plaintext highlighter-rouge">sell</code> on the same ID more than once? There is a danger of it being added multiple times to the <code class="language-plaintext highlighter-rouge">transactions</code> table. Stored procedures can be considerably improved in logic and complexity by using some regular old programming constructs. The following list contains some popular constructs available in MySQL.</p>

    <p class="w-50"><img src="images/70.jpg" alt="&quot;Programming constructs in MySQL&quot;"></p>
  </li>
</ul>

<h2 id="postgresql">PostgreSQL</h2>

<ul>
  <li data-marker="*">So far in this lecture, we’ve seen how to use MySQL, which gives us some ability to scale over what SQLite can provide.</li>
  <li data-marker="*">We will now explore the affordances of PostgreSQL by following the same process as we did with MySQL. We will work with some existing SQLite databases and convert them into PostgreSQL.</li>
  <li data-marker="*">Going back to the MBTA database which had a table <code class="language-plaintext highlighter-rouge">cards</code>, let’s see what data types are available to us in PostgreSQL.
    <ul>
      <li data-marker="*"><strong>Integers</strong></li>
    </ul>

    <p class="w-50"><img src="images/74.jpg" alt="&quot;Integer types in PostgreSQL&quot;"></p>

    <p>We can observe that there are fewer options here than MySQL. PostgreSQL also provides unsigned integers, similar to MySQL. That would mean double the maximum value shown here can be stored in each inteeger type when working with unsigned integers.</p>
    <ul>
      <li data-marker="*"><strong>Serial</strong>
        <ul>
          <li data-marker="*">Serials are also integers, but they are serial numbers, usually used for primary keys.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li data-marker="*">
    <p>Let us connect to the database server by opening PSQL — the command line interface for PostgreSQL.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>psql postgresql://postgres@127.0.0.1:5432/postgres
</code></pre></div>    </div>

    <p>We can log in as the default Postgres user or the admin.</p>
  </li>
  <li data-marker="*">To view all the databases, we can run <code class="language-plaintext highlighter-rouge">\l</code> and it pulls up a list.</li>
  <li data-marker="*">
    <p>To create the MBTA database, we can run:</p>

    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="nv">"mbta"</span><span class="p">;</span>
</code></pre></div>    </div>
  </li>
  <li data-marker="*">To connect to this specific database, we can run <code class="language-plaintext highlighter-rouge">\c "mbta"</code>.</li>
  <li data-marker="*">To list out all the tables in the database, we can run <code class="language-plaintext highlighter-rouge">\dt</code>. Right now, though, we will see no tables within the database.</li>
  <li data-marker="*">
    <p>Finally, we can create the <code class="language-plaintext highlighter-rouge">cards</code> table, as proposed. We use a <code class="language-plaintext highlighter-rouge">SERIAL</code> data type for the ID column.</p>

    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">"cards"</span> <span class="p">(</span>
    <span class="nv">"id"</span> <span class="nb">SERIAL</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="nv">"id"</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>    </div>
  </li>
  <li data-marker="*">To describe a table in PostgreSQL, we can use a command like <code class="language-plaintext highlighter-rouge">\d "cards"</code>. On running this, we see some information about this table but in a slightly different format from MySQL.</li>
</ul>

<h3 id="questions-4">Questions</h3>

<blockquote>
  <p>How do you know in PostgreSQL if your query is resulting in an error?</p>
</blockquote>

<ul>
  <li data-marker="*">If you hit Enter and the database server does not say ptu, you will know there may be an error. It is also likely that PostgreSQL will give you some helpful error messages to point you in the right direction.</li>
</ul>

<h2 id="creating-postgresql-tables">Creating PostgreSQL Tables</h2>

<ul>
  <li data-marker="*">
    <p>The <code class="language-plaintext highlighter-rouge">stations</code> table is created in a similar manner to MySQL.</p>

    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">"stations"</span> <span class="p">(</span>
    <span class="nv">"id"</span> <span class="nb">SERIAL</span><span class="p">,</span>
    <span class="nv">"name"</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">UNIQUE</span><span class="p">,</span>
    <span class="nv">"line"</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="nv">"id"</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>    </div>

    <p>We can use <code class="language-plaintext highlighter-rouge">VARCHAR</code> in the same way as in MySQL. To keep things simple, we say that the <code class="language-plaintext highlighter-rouge">"line"</code> column id also of the <code class="language-plaintext highlighter-rouge">VARCHAR</code> type.</p>
  </li>
  <li data-marker="*">
    <p>We want to create the <code class="language-plaintext highlighter-rouge">swipes</code> table next. Recall that the swipe type can mark entry, exit or deposit of funds in the card. Similar to MySQL, we can use an <code class="language-plaintext highlighter-rouge">ENUM</code> to capture these options, but do not include it in the column definition. Instead, we create our own type.</p>

    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TYPE</span> <span class="nv">"swipe_type"</span> <span class="k">AS</span> <span class="nb">ENUM</span><span class="p">(</span><span class="s1">'enter'</span><span class="p">,</span> <span class="s1">'exit'</span><span class="p">,</span> <span class="s1">'deposit'</span><span class="p">);</span>
</code></pre></div>    </div>
  </li>
  <li data-marker="*">PostgreSQL has types <code class="language-plaintext highlighter-rouge">TIMESTAMP</code>, <code class="language-plaintext highlighter-rouge">DATE</code>, <code class="language-plaintext highlighter-rouge">TIME</code> and <code class="language-plaintext highlighter-rouge">INTERVAL</code> to represent date and time values. <code class="language-plaintext highlighter-rouge">INTERVAL</code> is used to capture how long something took, or the distance between times. Similar to MySQL, we can specify the precision with these types.</li>
  <li data-marker="*">A key difference with real number types in PostgreSQL is that the <code class="language-plaintext highlighter-rouge">DECIMAL</code> type is called <code class="language-plaintext highlighter-rouge">NUMERIC</code>.</li>
  <li data-marker="*">
    <p>We can now go ahead and create the <code class="language-plaintext highlighter-rouge">swipes</code> table as the following.</p>

    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">"swipes"</span> <span class="p">(</span>
    <span class="nv">"id"</span> <span class="nb">SERIAL</span><span class="p">,</span>
    <span class="nv">"card_id"</span> <span class="nb">INT</span><span class="p">,</span>
    <span class="nv">"station_id"</span> <span class="nb">INT</span><span class="p">,</span>
    <span class="nv">"type"</span> <span class="nv">"swipe_type"</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="nv">"datetime"</span> <span class="nb">TIMESTAMP</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="n">now</span><span class="p">(),</span>
    <span class="nv">"amount"</span> <span class="nb">NUMERIC</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">CHECK</span><span class="p">(</span><span class="nv">"amount"</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">),</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="nv">"id"</span><span class="p">),</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span><span class="p">(</span><span class="nv">"station_id"</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="nv">"stations"</span><span class="p">(</span><span class="nv">"id"</span><span class="p">),</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span><span class="p">(</span><span class="nv">"card_id"</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="nv">"cards"</span><span class="p">(</span><span class="nv">"id"</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>    </div>
    <p>For the default timestamp, we use a function provided to us by PostgreSQL called <code class="language-plaintext highlighter-rouge">now()</code> thst gives us the current timestamp!</p>
  </li>
  <li data-marker="*">To exit PostgreSQL, we use the command <code class="language-plaintext highlighter-rouge">\q</code>.</li>
</ul>

<h2 id="scaling-with-mysql">Scaling with MySQL</h2>

<ul>
  <li data-marker="*">Consider a database server for an application growing in demand. As the number of reads and writes coming in from the application begin to increase, the wait time for the queries to be processed by the server increases also.</li>
  <li data-marker="*">One approach here is to scale the database vertically. Scaling vertically is increasing capacity by increasing the computing power of the database server.</li>
  <li data-marker="*">Another approach is to scale horizontally. This means increasing capacity by distributing load across multiple servers. When we scale horizontally, we keep copies of our database on multiple servers (replication).</li>
  <li data-marker="*">There are three main models of replication: single-leader, multi-leader, and leaderless. Single-leader replication involves a single database server handling incoming writes and then copying those changes into other servers, while multi-leader replication involves multiple servers receiving updates, leading to increased complexity. Leaderless replication uses a different approach altogether that does not require leaders in this sense.</li>
  <li data-marker="*">Here, we will focus on the <strong>single-leader model of replication</strong>. In this model, the follower database server is a read replica: a copy of the database from which data may only be read. The leader server is designated to process writes to the database.</li>
  <li data-marker="*">Once the leader processes a write request, it could wait for the followers to replicate changes before doing anything else. This is called <strong>synchronous replication</strong>. While this ensures the database is always consistent, it may be too slow in responding to queries. In applications like finance or healthcare, where data consistency is extremely important, we might choose this kind of communication despite the disadvantages.</li>
  <li data-marker="*">Another kind is <strong>asynchronous replication</strong>, wherein the leader communicates with follower databases asynchronously to ensure changes are replicated. This method could be used in social media applications, where speed of response is extremely important.</li>
  <li data-marker="*">Another popular way of scaling is called <strong>sharding</strong>. This involves splitting the database into shards across multiple database servers. A word of caution with sharding: we want to avoid having a database hotspot, or a database server that becomes more frequently accessed than others. This could create an overload on that server.</li>
  <li data-marker="*">Another problem arises when we use sharding without replication. In this case, if one of the servers goes down, we will have an incomplete database. This creates a <strong>single point of failure</strong>: if one system goes down, our entire system is not usable.</li>
</ul>

<h2 id="access-controls">Access Controls</h2>

<ul>
  <li data-marker="*">Previously, we logged into MySQL using the root user. However, we can also create more users and give them some kind of access to the database.</li>
  <li data-marker="*">
    <p>Let’s create a new user called Carter (feel free to try with your own name here)!</p>

    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">USER</span> <span class="s1">'carter'</span> <span class="n">IDENTIFIED</span> <span class="k">BY</span> <span class="s1">'password'</span><span class="p">;</span>
</code></pre></div>    </div>
  </li>
  <li data-marker="*">We can log into MySQL now using the new user and password, in the same way we did with the root user previously.</li>
  <li data-marker="*">
    <p>When we create this new user, by default it has very few privileges. Try the following query.</p>

    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SHOW</span> <span class="n">DATABASES</span><span class="p">;</span>
</code></pre></div>    </div>

    <p>This only displays some of the default databases in the server.</p>
  </li>
  <li data-marker="*">If we log in again with the root user and run the above query, many more databases show up! This is because the root user has access to most everything in the server.</li>
  <li data-marker="*">Let us look at how we can grant access to users by discussing an example from previous weeks. We had a <code class="language-plaintext highlighter-rouge">rideshare</code> database with a <code class="language-plaintext highlighter-rouge">rides</code> table. In this table, we stored the names of riders, which is personally identifiable information (PII). We created a view called <code class="language-plaintext highlighter-rouge">analysis</code> which anonymized the names of the riders, intending to share only this view with an analyst or other user.</li>
  <li data-marker="*">
    <p>If we wanted to share the <code class="language-plaintext highlighter-rouge">analysis</code> view with the user we just created, we would do the following while logged in as the root user.</p>

    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">GRANT</span> <span class="k">SELECT</span> <span class="k">ON</span> <span class="nv">`rideshare`</span><span class="p">.</span><span class="nv">`analysis`</span> <span class="k">TO</span> <span class="s1">'carter'</span><span class="p">;</span>
</code></pre></div>    </div>
  </li>
  <li data-marker="*">
    <p>Now, let’s log in as the new user and verify that we can access the view. We are now able to run</p>

    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">USE</span> <span class="nv">`rideshare`</span><span class="p">;</span>
</code></pre></div>    </div>
  </li>
  <li data-marker="*">The only part of the database, however, that this user can access is the <code class="language-plaintext highlighter-rouge">analysis</code> view. We can now see the data in this view, but not from the original <code class="language-plaintext highlighter-rouge">rides</code> table! We just demonstrated the benefit of MySQL’s access control: we can have multiple users accessing the database but only allow some to access confidential data.</li>
</ul>

<h2 id="sql-injection-attacks">SQL Injection Attacks</h2>

<ul>
  <li data-marker="*">One way to increase security of our database is to use access control and grant only the necessary privileges to each user. However, our applications that use an SQL database could also be exposed to attacks — one of them is an SQL injection attack.</li>
  <li data-marker="*">As the name indicates, this involves a malicious user injecting some SQL phrases to complete an existing query within our application in an undesirable way.</li>
  <li data-marker="*">
    <p>For example, a website that asks a user to log in with their username and password may be running a query like this on the database.</p>

    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="nv">`id`</span> <span class="k">FROM</span> <span class="nv">`users`</span>
<span class="k">WHERE</span> <span class="nv">`user`</span> <span class="o">=</span> <span class="s1">'Carter'</span> <span class="k">AND</span> <span class="nv">`password`</span> <span class="o">=</span> <span class="s1">'password'</span><span class="p">;</span>
</code></pre></div>    </div>
  </li>
  <li data-marker="*">
    <p>In the above example, the user Carter entered their username and password as per usual. However, a malicious user could enter something different, like the string “password’ OR ‘1’ = 1” as their password. In this case, they are trying to gain access to the entire database of users and passwords.</p>

    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="nv">`id`</span> <span class="k">FROM</span> <span class="nv">`users`</span>
<span class="k">WHERE</span> <span class="nv">`user`</span> <span class="o">=</span> <span class="s1">'Carter'</span> <span class="k">AND</span> <span class="nv">`password`</span> <span class="o">=</span> <span class="s1">'password'</span> <span class="k">OR</span> <span class="s1">'1'</span> <span class="o">=</span> <span class="s1">'1'</span><span class="p">;</span>
</code></pre></div>    </div>
  </li>
  <li data-marker="*">In MySQL, we can use prepared statements to prevent SQL injection attacks. Let’s connect to MySQL with the user we created previously and change to the <code class="language-plaintext highlighter-rouge">bank</code> database.</li>
  <li data-marker="*">
    <p>An example of an SQL injection attack that can be run to display all user accounts from the <code class="language-plaintext highlighter-rouge">accounts</code> table is this.</p>

    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="nv">`accounts`</span>
<span class="k">WHERE</span> <span class="nv">`id`</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">UNION</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="nv">`accounts`</span><span class="p">;</span>
</code></pre></div>    </div>
  </li>
  <li data-marker="*">
    <p>A prepared statement is a statement in SQL that we can later insert values into. For the above query, we can write a prepared statement.</p>

    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">PREPARE</span> <span class="nv">`balance_check`</span>
<span class="k">FROM</span> <span class="s1">'SELECT * FROM `accounts`
WHERE `id` = ?'</span><span class="p">;</span>
</code></pre></div>    </div>

    <p>The question mark in the prepared statement acts as a safeguard against the unintended execution of SQL code.</p>
  </li>
  <li data-marker="*">
    <p>To actually run this statement now and check someone’s balance, we accept user input as a variable and then plug it into the prepared statement.</p>

    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SET</span> <span class="o">@</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">EXECUTE</span> <span class="nv">`balance_check`</span> <span class="k">USING</span> <span class="o">@</span><span class="n">id</span><span class="p">;</span>
</code></pre></div>    </div>

    <p>In the above code, imagine the <code class="language-plaintext highlighter-rouge">SET</code> statement to be procuring the user’s ID through the application! The <code class="language-plaintext highlighter-rouge">@</code> is a convention for variables in MySQL.</p>
  </li>
  <li data-marker="*">
    <p>The prepared statement cleans up input to ensure that no malicious SQL code is injected. Let’s try to run the same statements as above but with a malicious ID.</p>

    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SET</span> <span class="o">@</span><span class="n">id</span> <span class="o">=</span> <span class="s1">'1 UNION SELECT * FROM `accounts`'</span><span class="p">;</span>
<span class="k">EXECUTE</span> <span class="nv">`balance_check`</span> <span class="k">USING</span> <span class="o">@</span><span class="n">id</span><span class="p">;</span>
</code></pre></div>    </div>

    <p>This also gives us the same results as the previous code — it shows us the balance of the user with ID 1 and nothing else! Thus, we have prevented a possible SQL injection attack.</p>
  </li>
</ul>

<h2 id="questions-5">Questions</h2>

<blockquote>
  <p>In this example of prepared statement, does it take into account only the first condition from the variable?</p>
</blockquote>

<ul>
  <li data-marker="*">The prepared statement does something called escaping. It finds all the portions of the variable that could be malicious and escapes them so they don’t actually get executed.</li>
</ul>

<blockquote>
  <p>Is this similar to the reason we shouldn’t use formatted strings in Python to execute an SQL query?</p>
</blockquote>

<ul>
  <li data-marker="*">Yes, format strings in Python have the same pitfall where they are susceptible to SQL injection attacks.</li>
</ul>

<h2 id="fin">Fin</h2>

<ul>
  <li data-marker="*">This brings us to the conclusion of Lecture 6 about Scaling in SQL and this course — CS50’s Introduction to Databases with SQL!</li>
</ul>


                </main>

            </div>

        </div>

        
 
        <script src="../../assets/page.js?1696908740"></script>

    


</body></html>